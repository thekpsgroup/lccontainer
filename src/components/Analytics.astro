---
// Analytics component for privacy-first tracking
---

<!-- Vercel Analytics Script -->
<script>
  // Vercel Analytics
  window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments) };
</script>
<script defer src="/_vercel/insights/script.js"></script>

<!-- Enhanced Conversion Tracking -->
<script>
  // Track form submissions
  document.addEventListener('DOMContentLoaded', function() {
    const forms = document.querySelectorAll('form');
    forms.forEach(form => {
      form.addEventListener('submit', function(e) {
        // Track form submission with Vercel Analytics
        if (typeof va !== 'undefined') {
          va('event', 'form_submit', {
            form_type: form.getAttribute('data-form-type') || 'contact',
            page: window.location.pathname
          });
        }
      });
    });

    // Track phone number clicks
    const phoneLinks = document.querySelectorAll('a[href^="tel:"]');
    phoneLinks.forEach(link => {
      link.addEventListener('click', function() {
        // Track phone clicks with Vercel Analytics
        if (typeof va !== 'undefined') {
          va('event', 'phone_click', {
            phone_number: this.href.replace('tel:', ''),
            page: window.location.pathname
          });
        }
      });
    });

    // Track CTA button clicks with more detail
    const ctaButtons = document.querySelectorAll('a[href="/contact"], .cta-button, .btn-primary, [data-cta]');
    ctaButtons.forEach(button => {
      button.addEventListener('click', function() {
        const ctaText = this.textContent?.trim() || 'Unknown CTA';
        const ctaLocation = this.closest('[data-section]')?.getAttribute('data-section') ||
                           this.closest('header, footer, nav')?.tagName.toLowerCase() ||
                           'body';
        const ctaType = this.getAttribute('data-cta') || 'quote_form';

        // Track CTA clicks with detailed info
        if (typeof va !== 'undefined') {
          va('event', 'cta_click', {
            cta_type: ctaType,
            cta_text: ctaText,
            cta_location: ctaLocation,
            page: window.location.pathname,
            href: this.getAttribute('href') || ''
          });
        }

        // Also track with Google Analytics if available
        if (typeof gtag !== 'undefined') {
          gtag('event', 'click', {
            event_category: 'cta',
            event_label: `${ctaLocation}_${ctaType}`,
            value: 1
          });
        }
      });
    });

    // Track sticky mobile CTA specifically
    const stickyCTA = document.querySelector('.fixed.bottom-0');
    if (stickyCTA) {
      const stickyButtons = stickyCTA.querySelectorAll('a');
      stickyButtons.forEach(button => {
        button.addEventListener('click', function() {
          const buttonType = this.href?.includes('tel:') ? 'phone' : 'quote';

          if (typeof va !== 'undefined') {
            va('event', 'sticky_cta_click', {
              button_type: buttonType,
              cta_text: this.textContent?.trim(),
              page: window.location.pathname
            });
          }
        });
      });
    }

    // Track scroll depth
    let maxScroll = 0;
    window.addEventListener('scroll', function() {
      const scrollPercent = Math.round((window.scrollY / (document.body.scrollHeight - window.innerHeight)) * 100);
      if (scrollPercent > maxScroll) {
        maxScroll = scrollPercent;
        
        // Track scroll depth with Vercel Analytics
        if (maxScroll >= 25 && maxScroll < 50) {
          if (typeof va !== 'undefined') {
            va('event', 'scroll_depth', {
              depth: '25%',
              page: window.location.pathname
            });
          }
        } else if (maxScroll >= 50 && maxScroll < 75) {
          if (typeof va !== 'undefined') {
            va('event', 'scroll_depth', {
              depth: '50%',
              page: window.location.pathname
            });
          }
        } else if (maxScroll >= 75 && maxScroll < 100) {
          if (typeof va !== 'undefined') {
            va('event', 'scroll_depth', {
              depth: '75%',
              page: window.location.pathname
            });
          }
        } else if (maxScroll >= 100) {
          if (typeof va !== 'undefined') {
            va('event', 'scroll_depth', {
              depth: '100%',
              page: window.location.pathname
            });
          }
        }
      }
    });

    // Track time on page
    let startTime = Date.now();
    window.addEventListener('beforeunload', function() {
      const timeOnPage = Math.round((Date.now() - startTime) / 1000);
      
      // Track time on page with Vercel Analytics
      if (typeof va !== 'undefined') {
        va('event', 'time_on_page', {
          duration: timeOnPage,
          page: window.location.pathname
        });
      }
    });
  });
</script>
