---
// Analytics component for privacy-first tracking
---

<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'GA_MEASUREMENT_ID', {
    page_title: document.title,
    page_location: window.location.href,
    custom_map: {
      'custom_parameter_1': 'project_type',
      'custom_parameter_2': 'service_area'
    }
  });
</script>

<!-- Vercel Analytics -->
<script>
  window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments); };
</script>
<script defer src="/_vercel/insights/script.js"></script>

<!-- Enhanced Conversion Tracking -->
<script>
  // Track form submissions
  document.addEventListener('DOMContentLoaded', function() {
    const forms = document.querySelectorAll('form');
    forms.forEach(form => {
      form.addEventListener('submit', function(e) {
        // Track form submission
        if (typeof gtag !== 'undefined') {
          gtag('event', 'form_submit', {
            'event_category': 'Lead Generation',
            'event_label': form.getAttribute('data-form-type') || 'Contact Form'
          });
        }
        
        // Track with Vercel Analytics
        if (typeof va !== 'undefined') {
          va('event', 'form_submit', {
            form_type: form.getAttribute('data-form-type') || 'contact',
            page: window.location.pathname
          });
        }
      });
    });

    // Track phone number clicks
    const phoneLinks = document.querySelectorAll('a[href^="tel:"]');
    phoneLinks.forEach(link => {
      link.addEventListener('click', function() {
        if (typeof gtag !== 'undefined') {
          gtag('event', 'phone_click', {
            'event_category': 'Contact',
            'event_label': 'Phone Call'
          });
        }
        
        if (typeof va !== 'undefined') {
          va('event', 'phone_click', {
            phone_number: this.href.replace('tel:', ''),
            page: window.location.pathname
          });
        }
      });
    });

    // Track CTA button clicks
    const ctaButtons = document.querySelectorAll('.cta-button, .btn-primary, [data-cta]');
    ctaButtons.forEach(button => {
      button.addEventListener('click', function() {
        const ctaType = this.getAttribute('data-cta') || 'general';
        
        if (typeof gtag !== 'undefined') {
          gtag('event', 'cta_click', {
            'event_category': 'Conversion',
            'event_label': ctaType
          });
        }
        
        if (typeof va !== 'undefined') {
          va('event', 'cta_click', {
            cta_type: ctaType,
            page: window.location.pathname
          });
        }
      });
    });

    // Track scroll depth
    let maxScroll = 0;
    window.addEventListener('scroll', function() {
      const scrollPercent = Math.round((window.scrollY / (document.body.scrollHeight - window.innerHeight)) * 100);
      if (scrollPercent > maxScroll) {
        maxScroll = scrollPercent;
        
        // Track at 25%, 50%, 75%, 100%
        if (maxScroll >= 25 && maxScroll < 50) {
          if (typeof gtag !== 'undefined') {
            gtag('event', 'scroll_depth', {
              'event_category': 'Engagement',
              'event_label': '25%'
            });
          }
        } else if (maxScroll >= 50 && maxScroll < 75) {
          if (typeof gtag !== 'undefined') {
            gtag('event', 'scroll_depth', {
              'event_category': 'Engagement',
              'event_label': '50%'
            });
          }
        } else if (maxScroll >= 75 && maxScroll < 100) {
          if (typeof gtag !== 'undefined') {
            gtag('event', 'scroll_depth', {
              'event_category': 'Engagement',
              'event_label': '75%'
            });
          }
        } else if (maxScroll >= 100) {
          if (typeof gtag !== 'undefined') {
            gtag('event', 'scroll_depth', {
              'event_category': 'Engagement',
              'event_label': '100%'
            });
          }
        }
      }
    });

    // Track time on page
    let startTime = Date.now();
    window.addEventListener('beforeunload', function() {
      const timeOnPage = Math.round((Date.now() - startTime) / 1000);
      
      if (typeof gtag !== 'undefined') {
        gtag('event', 'time_on_page', {
          'event_category': 'Engagement',
          'value': timeOnPage
        });
      }
      
      if (typeof va !== 'undefined') {
        va('event', 'time_on_page', {
          duration: timeOnPage,
          page: window.location.pathname
        });
      }
    });
  });
</script>
