---
export interface Props {
  phoneNumber?: string;
  size?: "sm" | "md" | "lg";
  class?: string;
  "data-cta"?: string;
  "aria-label"?: string;
}

const {
  phoneNumber = "12145244168", // Default phone number
  size = "md",
  class: className = "",
  "data-cta": dataCta,
  "aria-label": ariaLabel,
} = Astro.props;

// Format phone number for display
const formatPhoneNumber = (phone: string) => {
  const cleaned = phone.replace(/\D/g, "");
  const match = cleaned.match(/^(\d{1})(\d{3})(\d{3})(\d{4})$/);
  if (match) {
    return `(${match[2]}) ${match[3]}-${match[4]}`;
  }
  return phone;
};

const displayPhone = formatPhoneNumber(phoneNumber);
const telHref = `tel:${phoneNumber}`;

// Size-based styles
const sizeStyles = {
  sm: "padding: 8px 16px; font-size: 14px; min-height: 40px;",
  md: "padding: 12px 24px; font-size: 16px; min-height: 48px;",
  lg: "padding: 16px 32px; font-size: 18px; min-height: 56px;",
}[size];

// Phone button styles - always primary red styling
const buttonStyle = `background-color: #dc2626; color: #ffffff; border: 1px solid #b91c1c; ${sizeStyles} border-radius: 8px; font-weight: 600; font-family: inherit; text-decoration: none; display: inline-flex; align-items: center; justify-content: center; gap: 8px; cursor: pointer; transition: all 0.2s ease; box-sizing: border-box; line-height: 1.2; vertical-align: middle;`;
---

<a
  href={telHref}
  style={buttonStyle}
  role="button"
  aria-label={ariaLabel || `Call us at ${displayPhone}`}
  data-cta={dataCta}
  class={`phone-btn-${size} ${className}`}
  onmouseenter="this.style.backgroundColor='#b91c1c'; this.style.transform='translateY(-1px)'"
  onmouseleave="this.style.backgroundColor='#dc2626'; this.style.transform='translateY(0)'"
>
  <span style="font-style: normal; margin-right: 4px;">ðŸ“ž</span>
  <span style="color: inherit; font-weight: inherit; font-size: inherit;">
    Call {displayPhone}
  </span>
</a>

<!-- Phone button tracking -->
<script is:inline>
  document.addEventListener("DOMContentLoaded", function () {
    // Enhanced phone button hover effects
    const phoneButtons = document.querySelectorAll('a[href^="tel:"]');
    phoneButtons.forEach(function (btn) {
      btn.addEventListener("mouseenter", function () {
        this.style.background = "#b91c1c";
        this.style.transform = "translateY(-1px)";
        this.style.boxShadow = "0 4px 8px rgba(220, 38, 38, 0.3)";
      });

      btn.addEventListener("mouseleave", function () {
        this.style.background = "#dc2626";
        this.style.transform = "translateY(0)";
        this.style.boxShadow = "none";
      });
    });
  });

  // Phone call tracking
  document.addEventListener("click", function (e) {
    if (e.target.matches('a[href^="tel:"]')) {
      try {
        if (typeof window !== "undefined" && window.gtag) {
          window.gtag("event", "phone_call", {
            event_category: "cta",
            event_label: "phone_call_initiated",
            phone_number: e.target.href.replace("tel:", ""),
          });
        }
      } catch (error) {
        console.debug("Phone tracking error:", error);
      }
    }
  });
</script>

<style>
  /* Phone button styles */
  a[href^="tel:"] {
    background: #dc2626 !important;
    background-color: #dc2626 !important;
    color: #ffffff !important;
    border: 1px solid #b91c1c !important;
    border-radius: 8px !important;
    padding: 12px 24px !important;
    font-weight: 600 !important;
    font-size: 16px !important;
    line-height: 1.2 !important;
    text-decoration: none !important;
    display: inline-flex !important;
    align-items: center !important;
    justify-content: center !important;
    gap: 8px !important;
    box-sizing: border-box !important;
    cursor: pointer !important;
    transition: all 0.2s ease !important;
    min-height: 48px !important;
  }

  a[href^="tel:"]:hover {
    background: #b91c1c !important;
    background-color: #b91c1c !important;
    color: #ffffff !important;
    transform: translateY(-1px) !important;
    box-shadow: 0 4px 8px rgba(220, 38, 38, 0.3) !important;
  }

  a[href^="tel:"]:active {
    background: #991b1b !important;
    background-color: #991b1b !important;
    transform: translateY(0) !important;
  }

  /* Size variants */
  a[href^="tel:"].phone-btn-sm {
    padding: 8px 16px !important;
    font-size: 14px !important;
    min-height: 40px !important;
  }
  a[href^="tel:"].phone-btn-md {
    padding: 12px 24px !important;
    font-size: 16px !important;
    min-height: 48px !important;
  }
  a[href^="tel:"].phone-btn-lg {
    padding: 16px 32px !important;
    font-size: 18px !important;
    min-height: 56px !important;
  }

  /* Focus states for accessibility */
  a[href^="tel:"]:focus {
    outline: 2px solid #ef4444 !important;
    outline-offset: 2px !important;
  }
</style>
