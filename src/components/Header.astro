---
import SmartImage from "./SmartImage.astro";
import CTAButton from "./CTAButton.astro";
import OpenStatus from "./OpenStatus.astro";
import Nav from "./Nav.astro";
import MobileMenu from "./MobileMenu.astro";
---

<header
  class="sticky top-0 z-50 border-b border-grey-300 bg-white shadow-sm"
  id="header"
>
  <div
    class="max-w-[1200px] mx-auto px-5 flex h-16 items-center justify-between"
  >
    <a href="/" class="flex items-center gap-3">
      <img
        src="/photos/lccontainer-dark.png"
        alt="LC Container"
        class="h-10 w-auto"
      />
      <span class="sr-only">LC Container</span>
    </a>

    <Nav currentPath={Astro.url.pathname} />

    <div class="hidden md:flex items-center gap-5">
      <OpenStatus class="hidden lg:inline-flex" />
      <a href="tel:12145244168" class="text-brand-red font-bold text-lg hover:text-brand-red-dark">
        (214) 524-4168
      </a>
      <CTAButton
        size="md"
        phoneNumber="12145244168"
        data-cta="header_phone"
        aria-label="Call us now for a quote"
      />
    </div>

    <MobileMenu currentPath={Astro.url.pathname} />
  </div>
</header>

<script>
  // Mobile menu functionality
  const mobileMenuButton = document.getElementById("mobile-menu-button");
  const mobileMenu = document.getElementById("mobile-menu");

  if (mobileMenuButton && mobileMenu) {
    let isOpen = false;

    const toggleMenu = () => {
      isOpen = !isOpen;
      mobileMenu.classList.toggle("hidden", !isOpen);
      mobileMenuButton.setAttribute("aria-expanded", isOpen.toString());

      // Close menu when clicking outside
      if (isOpen) {
        const closeMenu = (e: MouseEvent) => {
          if (
            !mobileMenu.contains(e.target as Node) &&
            !mobileMenuButton.contains(e.target as Node)
          ) {
            mobileMenu.classList.add("hidden");
            mobileMenuButton.setAttribute("aria-expanded", "false");
            isOpen = false;
            document.removeEventListener("click", closeMenu);
            document.removeEventListener("keydown", handleEscape);
          }
        };

        const handleEscape = (e: KeyboardEvent) => {
          if (e.key === "Escape") {
            mobileMenu.classList.add("hidden");
            mobileMenuButton.setAttribute("aria-expanded", "false");
            isOpen = false;
            document.removeEventListener("click", closeMenu);
            document.removeEventListener("keydown", handleEscape);
          }
        };

        setTimeout(() => {
          document.addEventListener("click", closeMenu);
          document.addEventListener("keydown", handleEscape);
        }, 10);
      }
    };

    mobileMenuButton.addEventListener("click", toggleMenu);
  }
</script>
